<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>ê³¨í”„ ë¼ìš´ë“œ ê°„í¸ ê¸°ë¡</title>
<style>
:root{
  --bg:#071018;
  --card:#0d2328;
  --accent:#1fb57a;
  --accent-dark:#167a53;
  --text:#E8F0F3;
  --muted:#8fa3ad;
  --danger:#ff7b7b;
  --radius:10px;
}
*{box-sizing:border-box;margin:0;padding:0;}
html{-webkit-text-size-adjust:100%;height:100%;}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;
  -webkit-font-smoothing:antialiased;
  background:var(--bg);
  color:var(--text);
  padding:12px;
  font-size:16px;
  height:100%;
  overflow-y:auto;
}
.container{
  max-width:600px;
  margin:0 auto;
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:0 8px 24px rgba(0,0,0,0.4);
}
h1{
  font-size:24px;
  color:var(--accent);
  margin-bottom:8px;
  text-align:center;
}
.subtitle{
  text-align:center;
  color:var(--muted);
  font-size:13px;
  margin-bottom:20px;
}
.section{
  margin-bottom:20px;
  padding:12px;
  background:rgba(255,255,255,0.02);
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.05);
}
.section-title{
  font-size:14px;
  color:var(--accent);
  font-weight:700;
  margin-bottom:12px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.form-group{
  margin-bottom:12px;
}
.form-label{
  display:block;
  font-size:13px;
  color:var(--muted);
  margin-bottom:4px;
  font-weight:600;
}
input, select, textarea{
  width:100%;
  padding:10px;
  border:1px solid rgba(255,255,255,0.2);
  border-radius:6px;
  background:rgba(13,35,40,0.9);
  color:#ffffff;
  font-size:15px;
  font-family:inherit;
  font-weight:500;
}
input:focus, select:focus, textarea:focus{
  outline:none;
  border-color:var(--accent);
  background:rgba(13,35,40,1);
}
select option{
  background:#0d2328;
  color:#ffffff;
  padding:8px;
}
textarea{
  resize:vertical;
  min-height:60px;
}
.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:#04221a;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  margin-top:8px;
  transition:all 0.2s;
}
.btn:active{
  transform:scale(0.98);
}
.btn-secondary{
  background:rgba(255,255,255,0.1);
  color:var(--text);
}
.btn-danger{
  background:var(--danger);
  color:#fff;
}
.hole-nav{
  display:flex;
  gap:8px;
  margin-bottom:16px;
}
.hole-nav button{
  flex:1;
  padding:12px;
  font-size:15px;
}
.hole-info{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  background:rgba(31,181,122,0.1);
  border-radius:8px;
  margin-bottom:16px;
  border:1px solid rgba(31,181,122,0.2);
}
.hole-number{
  font-size:28px;
  font-weight:800;
  color:var(--accent);
}
.hole-details{
  text-align:right;
  font-size:14px;
}
.hole-details div{
  color:var(--muted);
  margin-bottom:2px;
}
.shot-list{
  margin-top:12px;
}
.shot-item{
  background:rgba(0,0,0,0.3);
  padding:10px;
  border-radius:6px;
  margin-bottom:8px;
  border:1px solid rgba(255,255,255,0.05);
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:all 0.2s ease;
}
.shot-item.selected{
  background:rgba(31,181,122,0.2);
  border:2px solid var(--accent);
  box-shadow:0 0 10px rgba(31,181,122,0.3);
}
.shot-info{
  flex:1;
}
.shot-info div:first-child{
  font-weight:700;
  color:var(--accent);
  margin-bottom:2px;
}
.shot-info div:last-child{
  font-size:13px;
  color:var(--muted);
}
.shot-delete{
  padding:6px 12px;
  background:var(--danger);
  border:none;
  border-radius:4px;
  color:#fff;
  font-size:12px;
  cursor:pointer;
}
.quick-buttons{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  margin-bottom:16px;
}
.quick-btn{
  padding:12px;
  background:rgba(255,255,255,0.05);
  border:none;
  border-radius:6px;
  color:var(--text);
  font-size:14px;
  cursor:pointer;
  transition:all 0.2s;
  font-weight:600;
}
.quick-btn:active{
  background:var(--accent);
  color:#000;
}
.status-bar{
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
  background:rgba(0,0,0,0.3);
  border-radius:6px;
  margin-bottom:16px;
  font-size:13px;
}
.status-item{
  display:flex;
  flex-direction:column;
  align-items:center;
}
.status-label{
  color:var(--muted);
  font-size:11px;
}
.status-value{
  font-weight:700;
  color:var(--accent);
  font-size:16px;
}
.hidden{display:none;}
.club-select-group{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  margin-bottom:12px;
}
.club-select-group select{
  font-size:14px;
  padding:8px;
  font-weight:600;
  border:2px solid rgba(31,181,122,0.3);
}
.club-select-group select:focus{
  border-color:var(--accent);
}
.putter-btn-container{
  margin-top:16px;
  margin-bottom:16px;
  padding:12px;
  background:rgba(255,255,255,0.02);
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.05);
}
.putter-btn{
  width:100%;
  padding:16px;
  background:rgba(255,255,255,0.1);
  border:2px solid rgba(31,181,122,0.3);
  border-radius:8px;
  color:var(--text);
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s;
}
.putter-btn.active{
  background:var(--accent);
  color:#04221a;
  border-color:var(--accent);
  transform:scale(1.02);
}
#btnLayup{
  transition:all 0.2s;
}
#btnLayup:hover{
  background:rgba(255,193,7,0.3);
}
#btnLayup.active{
  background:rgba(255,193,7,0.5);
  border-color:rgba(255,193,7,0.6);
  transform:scale(1.02);
}
.putter-count{
  text-align:center;
  margin-top:8px;
  font-size:14px;
  color:var(--muted);
}
.putter-count span{
  font-weight:700;
  color:var(--accent);
  font-size:18px;
}

/* í´ëŸ½ ì¶”ì²œ ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
#clubRecommendButtons button:hover{
  background:var(--accent-dark) !important;
  transform:scale(1.05);
}
#clubRecommendButtons button:active{
  transform:scale(0.95);
}

/* í¼í„° ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(31,181,122,0.6); }
}
</style>
</head>
<body>
<div class="container">
  <h1>â›³ ê³¨í”„ ê°„í¸ ê¸°ë¡</h1>
  <p class="subtitle">ê²½ê¸° ì¤‘ ë¹ ë¥¸ ìƒ· ê¸°ë¡ìš©</p>

  <!-- ë¼ìš´ë“œ ê¸°ë³¸ ì •ë³´ -->
  <div class="section" id="roundInfo">
    <div class="section-title">ë¼ìš´ë“œ ì •ë³´</div>
    <div class="form-group">
      <label class="form-label">ì„ ìˆ˜ ì´ë¦„</label>
      <input type="text" id="playerName" placeholder="ì´ë¦„ ì…ë ¥">
    </div>
    <div class="form-group">
      <label class="form-label">ë‚ ì§œ</label>
      <input type="date" id="roundDate">
    </div>
    <div class="form-group">
      <label class="form-label">ì½”ìŠ¤ ì´ë¦„</label>
      <input type="text" id="courseName" placeholder="ì½”ìŠ¤ ì´ë¦„">
    </div>
    <div class="form-group">
      <label class="form-label">ê±°ë¦¬ ë‹¨ìœ„</label>
      <select id="distanceUnit">
        <option value="yd">Yard (ì•¼ë“œ)</option>
        <option value="m">Meter (ë¯¸í„°)</option>
      </select>
    </div>
    <button class="btn" id="btnStartRound">ë¼ìš´ë“œ ì‹œì‘</button>
  </div>

  <!-- í™€ ê¸°ë¡ í™”ë©´ -->
  <div class="section hidden" id="recordSection">
    <!-- ì§„í–‰ ìƒíƒœ ë°” -->
    <div class="status-bar">
      <div class="status-item">
        <span class="status-label">í˜„ì¬ í™€</span>
        <span class="status-value" id="currentHoleNum">1</span>
      </div>
      <div class="status-item">
        <span class="status-label">ì´ ìƒ·</span>
        <span class="status-value" id="totalShots">0</span>
      </div>
      <div class="status-item">
        <span class="status-label">ì™„ë£Œ</span>
        <span class="status-value" id="completedHoles">0 / 18</span>
      </div>
    </div>

    <!-- í™€ ì •ë³´ -->
    <div class="hole-info">
      <div class="hole-number" id="holeNumber">0</div>
      <div class="hole-details">
        <div style="display:flex;gap:6px;align-items:center;justify-content:flex-end;">
          <span>Hole <span id="holeNumLabel" style="font-weight:700;">1</span></span>
        </div>
        <div style="display:flex;gap:6px;align-items:center;justify-content:flex-end;margin-top:4px;">
          <span>Par</span>
          <select id="holeParInput" style="width:60px;padding:4px;font-size:14px;">
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div style="display:flex;gap:4px;align-items:center;justify-content:flex-end;margin-top:4px;flex-wrap:wrap;">
          <input type="number" id="holeYardInput" value="400" min="50" max="700" style="width:65px;padding:4px;font-size:14px;text-align:right;" inputmode="decimal">
          <select id="holeInputUnit" style="width:45px;padding:2px;font-size:12px;">
            <option value="yd">yd</option>
            <option value="m">m</option>
          </select>
          <button id="btnConvertDistance" style="padding:2px 6px;font-size:11px;background:var(--accent);border:none;border-radius:4px;cursor:pointer;color:#000;font-weight:600;">â‡„</button>
          <span style="font-size:11px;color:var(--muted);">=</span>
          <span id="convertedDistance" style="font-size:12px;font-weight:600;color:var(--accent);">-</span>
          <span id="holeDistanceUnitLabel" style="font-size:12px;">yd</span>
        </div>
      </div>
    </div>

    <!-- í™€ íƒìƒ‰ -->
    <div class="hole-nav">
      <button class="btn btn-secondary" id="btnPrevHole">â—€ ì´ì „</button>
      <button class="btn btn-secondary" id="btnNextHole">ë‹¤ìŒ â–¶</button>
    </div>

    <!-- ìƒ· ì…ë ¥ í¼ -->
    <div class="section-title">ìƒ· ê¸°ë¡</div>
    
    <!-- ë‹¨ê³„ 1: ê±°ë¦¬ ì…ë ¥ (2íƒ€ ì´í›„) -->
    <div id="distanceInputSection" class="hidden" style="margin-bottom:16px;">
      <div class="form-group">
        <label class="form-label" style="color:var(--accent); font-size:15px; font-weight:700;">í™€ê¹Œì§€ ë‚¨ì€ ê±°ë¦¬ ì…ë ¥</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input type="number" id="distanceToHole" placeholder="ì˜ˆ: 120 ë˜ëŠ” -10" style="flex:1;">
          <span id="shotDistanceUnitLabel" style="font-weight:600;">yd</span>
        </div>
        <div style="font-size:11px; color:var(--muted); margin-top:4px;">â€» í™€ì„ ì§€ë‚˜ì¹œ ê²½ìš° ìŒìˆ˜(-)ë¡œ ì…ë ¥</div>
      </div>
      <button class="btn" id="btnConfirmDistance">í™•ì¸</button>
    </div>
    
    <!-- ë‹¨ê³„ 2: ì¶”ì²œ í´ëŸ½ (ê±°ë¦¬ ì…ë ¥ í›„) -->
    <div id="clubRecommendSection" class="hidden" style="margin-bottom:16px;">
      <div style="padding:12px; background:rgba(31,181,122,0.15); border:1px solid rgba(31,181,122,0.3); border-radius:6px;">
        <div style="font-size:14px; color:var(--accent); font-weight:700; margin-bottom:8px; text-align:center;">ì¶”ì²œ í´ëŸ½</div>
        <div style="font-size:13px; color:var(--muted); margin-bottom:8px; text-align:center;">ë‚¨ì€ ê±°ë¦¬: <span id="displayDistance" style="color:var(--accent); font-weight:700;"></span></div>
        <div id="clubRecommendButtons" style="display:flex; flex-wrap:wrap; gap:6px; justify-content:center;"></div>
        <button type="button" id="btnManualClubSelect" style="width:100%; margin-top:12px; padding:10px; background:rgba(255,255,255,0.1); color:var(--text); border:1px solid rgba(255,255,255,0.3); border-radius:6px; cursor:pointer; font-size:14px; font-weight:600;">ğŸ“‹ ì§ì ‘ ì„ íƒ</button>
      </div>
    </div>
    
    <!-- ë‹¨ê³„ 3: í´ëŸ½ ì„ íƒ -->
    <div id="clubSelectSection" class="form-group">
      <label class="form-label">í´ëŸ½</label>
      <div class="club-select-group">
        <select id="clubWood">
          <option value="">í‹°ìƒ·</option>
          <option value="Driver">ë“œë¼ì´ë²„</option>
          <option value="3Wood">3W</option>
          <option value="5Wood">5W</option>
          <option value="Utility1">UT1</option>
          <option value="Utility2">UT2</option>
        </select>
        <select id="clubIronWedge">
          <option value="">ì„¸ì»¨/ì¨ë“œìƒ·</option>
          <option value="4Iron">4I</option>
          <option value="5Iron">5I</option>
          <option value="6Iron">6I</option>
          <option value="7Iron">7I</option>
          <option value="8Iron">8I</option>
          <option value="9Iron">9I</option>
          <option value="PW">PW</option>
          <option value="Wedge1">ì›¨ì§€1</option>
          <option value="Wedge2">ì›¨ì§€2</option>
          <option value="Wedge3">ì›¨ì§€3</option>
          <option value="SW">SW</option>
          <option value="AW">AW</option>
        </select>
      </div>
    </div>
    
    <!-- ë‹¨ê³„ 4: ê²°ê³¼ ì…ë ¥ -->
    <div id="resultInputSection">
      <div class="form-group">
        <label class="form-label">ê²°ê³¼</label>
        <select id="shotResult">
          <option value="Fairway">í˜ì–´ì›¨ì´</option>
          <option value="LeftRough">ì¢Œì¸¡ ëŸ¬í”„</option>
          <option value="RightRough">ìš°ì¸¡ ëŸ¬í”„</option>
          <option value="Green">ê·¸ë¦°</option>
          <option value="AroundGreen">ê·¸ë¦° ì£¼ë³€</option>
          <option value="InHole">í™€ì¸</option>
          <option value="Bunker_Fairway">í˜ì–´ì›¨ì´ ë²™ì»¤</option>
          <option value="Bunker_Greenside">ê·¸ë¦°ì‚¬ì´ë“œ ë²™ì»¤</option>
          <option value="Water">ì›Œí„°</option>
          <option value="Out">OB</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">í˜ë„í‹°</label>
        <input type="number" id="penalty" value="0" min="0" inputmode="decimal">
      </div>

      <div class="form-group">
        <label class="form-label">ë©”ëª¨</label>
        <textarea id="shotNote" placeholder="ì„ íƒ ì‚¬í•­"></textarea>
      </div>

      <button class="btn" id="btnAddShot">ì €ì¥</button>
    </div>
    
    <div class="form-group" style="margin-top:16px;">
      <label class="form-label">í¼íŒ… ì •ë³´</label>
      <div style="display:flex; gap:8px; margin-bottom:8px;">
        <select id="puttLie" style="flex:1;">
          <option value="OnGreen">ê·¸ë¦°</option>
          <option value="Fringe">í”„ë¦°ì§€</option>
          <option value="Bare">ë§¨ë•…</option>
          <option value="Rough">ëŸ¬í”„</option>
          <option value="Other">ê¸°íƒ€</option>
        </select>
        <select id="puttSlope" style="flex:1;">
          <option value="Flat">í‰ì§€</option>
          <option value="Uphill">ì˜¤ë¥´ë§‰</option>
          <option value="Downhill">ë‚´ë¦¬ë§‰</option>
          <option value="Sidehill">ì‚¬ì´ë“œí</option>
        </select>
        <input type="number" id="puttDistance" placeholder="ê±°ë¦¬" min="0" style="flex:1;" inputmode="numeric">
        <span id="puttDistanceUnitLabel" style="font-size:12px; color:var(--muted); align-self:center;">yd</span>
      </div>
    </div>
    
    <div style="display:flex; gap:8px; margin-top:16px; margin-bottom:16px;">
      <div class="putter-btn-container" style="flex:1; margin:0;">
        <button type="button" class="putter-btn" id="btnPutter">â›³ í¼í„°</button>
        <div class="putter-count">í¼íŒ…: <span id="putterCount">0</span>íƒ€</div>
      </div>
      <div class="putter-btn-container" style="flex:1; margin:0;">
        <button type="button" class="putter-btn" id="btnLayup" style="background:rgba(255,193,7,0.2); border-color:rgba(255,193,7,0.4);">ğŸ¯ ë ˆì´ì—…</button>
        <div class="putter-count" style="font-size:11px; color:var(--muted);">í†µê³„ ì œì™¸</div>
      </div>
    </div>

    <!-- ê¸°ë¡ëœ ìƒ· ë¦¬ìŠ¤íŠ¸ -->
    <div class="shot-list" id="shotList"></div>

    <div style="display:flex;gap:8px;margin-top:16px;">
      <button class="btn btn-secondary" id="btnCompleteHole" style="flex:1;margin:0;">í™€ ì™„ë£Œ</button>
      <button class="btn" id="btnEditHole" style="flex:1;margin:0;background:var(--accent-dark);">ìˆ˜ì •</button>
    </div>
  </div>

  <!-- ì €ì¥ ë° ë‚´ë³´ë‚´ê¸° -->
  <div class="section hidden" id="exportSection">
    <div class="section-title">ì €ì¥ ë° ë‚´ë³´ë‚´ê¸°</div>
    <button class="btn" id="btnExportCSV">CSV íŒŒì¼ë¡œ ì €ì¥</button>
    <button class="btn btn-secondary" id="btnReset">ìƒˆ ë¼ìš´ë“œ ì‹œì‘</button>
  </div>
</div>

<script>
// ë°ì´í„° êµ¬ì¡°
let roundData = {
  player: '',
  date: '',
  course: '',
  distanceUnit: 'yd', // ê¸°ë³¸ ë‹¨ìœ„: ì•¼ë“œ
  holes: []
};

// 18í™€ ì´ˆê¸°í™”
for(let i = 1; i <= 18; i++){
  roundData.holes.push({
    hole: i,
    par: 4,
    yard: 400,
    shots: []
  });
}

let currentHole = 0; // 0-17 ì¸ë±ìŠ¤

// DOM ìš”ì†Œ
const roundInfo = document.getElementById('roundInfo');
const recordSection = document.getElementById('recordSection');
const exportSection = document.getElementById('exportSection');
const btnStartRound = document.getElementById('btnStartRound');
const btnPrevHole = document.getElementById('btnPrevHole');
const btnNextHole = document.getElementById('btnNextHole');
const btnAddShot = document.getElementById('btnAddShot');
const btnCompleteHole = document.getElementById('btnCompleteHole');
const btnEditHole = document.getElementById('btnEditHole');
const btnExportCSV = document.getElementById('btnExportCSV');
const btnReset = document.getElementById('btnReset');
const btnConfirmDistance = document.getElementById('btnConfirmDistance');
const btnManualClubSelect = document.getElementById('btnManualClubSelect');

const distanceInputSection = document.getElementById('distanceInputSection');
const clubRecommendSection = document.getElementById('clubRecommendSection');
const clubSelectSection = document.getElementById('clubSelectSection');
const resultInputSection = document.getElementById('resultInputSection');
const clubRecommendButtons = document.getElementById('clubRecommendButtons');
const displayDistance = document.getElementById('displayDistance');

const playerNameInput = document.getElementById('playerName');
const roundDateInput = document.getElementById('roundDate');
const courseNameInput = document.getElementById('courseName');
const distanceUnitSel = document.getElementById('distanceUnit');
const holeDistanceUnitLabel = document.getElementById('holeDistanceUnitLabel');
const shotDistanceUnitLabel = document.getElementById('shotDistanceUnitLabel');

const clubWoodSel = document.getElementById('clubWood');
const clubIronWedgeSel = document.getElementById('clubIronWedge');
const btnPutter = document.getElementById('btnPutter');
const btnLayup = document.getElementById('btnLayup');
const putterCountEl = document.getElementById('putterCount');
const puttLieEl = document.getElementById('puttLie');
const puttSlopeEl = document.getElementById('puttSlope');
const puttDistanceEl = document.getElementById('puttDistance');
const puttDistanceUnitLabel = document.getElementById('puttDistanceUnitLabel');
const shotResultSel = document.getElementById('shotResult');
const distanceInput = document.getElementById('distanceToHole');
const penaltyInput = document.getElementById('penalty');
const shotNoteInput = document.getElementById('shotNote');

// í¼í„° ì¹´ìš´í„° ë³€ìˆ˜
let putterCount = 0;

// ìƒ· ì¶”ê°€ ë²„íŠ¼ ìƒíƒœ (true: ì €ì¥ ëª¨ë“œ, false: ìƒ· ì¶”ê°€ ëª¨ë“œ)
let isSaveMode = true;
// í¸ì§‘ ì¤‘ì¸ ìƒ·ì˜ ì¸ë±ìŠ¤ (-1: ìƒˆ ìƒ· ì¶”ê°€, 0 ì´ìƒ: í•´ë‹¹ ì¸ë±ìŠ¤ ìƒ· ìˆ˜ì •)
let editingIndex = -1;
// í˜„ì¬ ì…ë ¥ ë‹¨ê³„ (distance: ê±°ë¦¬ ì…ë ¥, club: í´ëŸ½ ì„ íƒ, result: ê²°ê³¼ ì…ë ¥)
let currentInputStep = 'club';
// ë°©ê¸ˆ ì €ì¥í•œ ìƒ·ì˜ ì¸ë±ìŠ¤ (ê±°ë¦¬ ì—…ë°ì´íŠ¸ìš©)
let lastShotIndex = -1;

const holeNumberEl = document.getElementById('holeNumber'); // í° ìˆ«ì: ìƒ· ê°œìˆ˜ í‘œì‹œ
const holeNumLabelEl = document.getElementById('holeNumLabel'); // í™€ ë²ˆí˜¸ í‘œì‹œ
const holeParInputEl = document.getElementById('holeParInput');
const holeYardInputEl = document.getElementById('holeYardInput');
const holeInputUnitEl = document.getElementById('holeInputUnit');
const btnConvertDistance = document.getElementById('btnConvertDistance');
const convertedDistanceEl = document.getElementById('convertedDistance');
const shotListEl = document.getElementById('shotList');

const currentHoleNumEl = document.getElementById('currentHoleNum');
const totalShotsEl = document.getElementById('totalShots');
const completedHolesEl = document.getElementById('completedHoles');

// ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’
roundDateInput.value = new Date().toISOString().slice(0,10);

// ë¡œì»¬ ì €ì¥ì†Œ í‚¤
const STORAGE_KEY = 'golf_quick_record_data';

// ë¼ìš´ë“œ ì‹œì‘
btnStartRound.addEventListener('click', ()=>{
  roundData.player = playerNameInput.value.trim();
  roundData.date = roundDateInput.value;
  roundData.course = courseNameInput.value.trim();
  roundData.distanceUnit = distanceUnitSel.value; // ë‹¨ìœ„ ì €ì¥
  
  // ë‹¨ìœ„ ë¼ë²¨ ì—…ë°ì´íŠ¸
  updateDistanceUnitLabels();
  
  // ëª¨ë“  í™€ì˜ ìƒ· ë°ì´í„° ì´ˆê¸°í™”
  for(let i = 0; i < 18; i++){
    roundData.holes[i].shots = [];
  }
  
  roundInfo.classList.add('hidden');
  recordSection.classList.remove('hidden');
  exportSection.classList.remove('hidden');
  
  currentHole = 0;
  updateHoleDisplay();
  saveData();
});

// ê±°ë¦¬ ë‹¨ìœ„ ë¼ë²¨ ì—…ë°ì´íŠ¸
function updateDistanceUnitLabels(){
  const unit = roundData.distanceUnit || 'yd';
  holeDistanceUnitLabel.textContent = unit;
  shotDistanceUnitLabel.textContent = unit;
  puttDistanceUnitLabel.textContent = unit;
  // ì…ë ¥ ë‹¨ìœ„ ê¸°ë³¸ê°’ì„ ë¼ìš´ë“œ ë‹¨ìœ„ë¡œ ì„¤ì •
  holeInputUnitEl.value = unit;
  updateConvertedDistance();
}

// ê±°ë¦¬ ë³€í™˜ í•¨ìˆ˜
function convertDistance(value, fromUnit, toUnit){
  if(fromUnit === toUnit) return value;
  if(fromUnit === 'yd' && toUnit === 'm'){
    return Math.round(value * 0.9144);
  }
  if(fromUnit === 'm' && toUnit === 'yd'){
    return Math.round(value * 1.09361);
  }
  return value;
}

// ë³€í™˜ëœ ê±°ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateConvertedDistance(){
  const inputValue = Number(holeYardInput.value) || 0;
  const inputUnit = holeInputUnitEl.value;
  const targetUnit = roundData.distanceUnit || 'yd';
  
  if(inputValue > 0){
    const converted = convertDistance(inputValue, inputUnit, targetUnit);
    convertedDistanceEl.textContent = converted;
  } else {
    convertedDistanceEl.textContent = '-';
  }
}

// ê±°ë¦¬ ë³€í™˜ ë²„íŠ¼ í´ë¦­
btnConvertDistance.addEventListener('click', ()=>{
  const inputValue = Number(holeYardInput.value) || 0;
  const inputUnit = holeInputUnitEl.value;
  const targetUnit = roundData.distanceUnit || 'yd';
  
  if(inputValue > 0){
    const converted = convertDistance(inputValue, inputUnit, targetUnit);
    // ë³€í™˜ëœ ê°’ìœ¼ë¡œ ì €ì¥
    roundData.holes[currentHole].yard = converted;
    holeYardInput.value = converted;
    holeInputUnitEl.value = targetUnit; // ì…ë ¥ ë‹¨ìœ„ë¥¼ ëª©í‘œ ë‹¨ìœ„ë¡œ ë³€ê²½
    saveData();
    updateConvertedDistance();
  }
});

// ì…ë ¥ê°’ì´ë‚˜ ë‹¨ìœ„ ë³€ê²½ ì‹œ ë³€í™˜ ê°’ ì—…ë°ì´íŠ¸
holeYardInput.addEventListener('input', updateConvertedDistance);
holeInputUnitEl.addEventListener('change', updateConvertedDistance);

// ë ˆì´ì—… ë²„íŠ¼ í´ë¦­ - ìƒ·ìˆ˜ë§Œ ì¦ê°€, ê±°ë¦¬ í†µê³„ ì œì™¸
btnLayup.addEventListener('click', ()=>{
  const hole = roundData.holes[currentHole];
  
  // ë ˆì´ì—… ìƒ· ìë™ ì¶”ê°€ - distanceToHoleì€ ë‚˜ì¤‘ì— ì—…ë°ì´íŠ¸
  const shot = {
    club: 'LayUp',
    result: 'Layup',
    distanceToHole: null, // ë‚˜ì¤‘ì— ê±°ë¦¬ ì…ë ¥ í›„ ì—…ë°ì´íŠ¸ (í†µê³„ì—ì„œ ì œì™¸í•˜ë ¤ë©´ null ìœ ì§€)
    putts: 0,
    penalty: 0,
    note: 'ë ˆì´ì—… (í†µê³„ ì œì™¸)',
    lie: '',
    slope: '',
    puttStartDistance: null,
    isLayup: true,
    timestamp: new Date().toISOString()
  };
  
  hole.shots.push(shot);
  lastShotIndex = hole.shots.length - 1;
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  clubWoodSel.value = '';
  clubIronWedgeSel.value = '';
  
  // í™”ë©´ ì—…ë°ì´íŠ¸
  holeNumberEl.textContent = hole.shots.length;
  updateStatusBar();
  renderShots();
  saveData();
  
  // ê±°ë¦¬ ì…ë ¥ ë‹¨ê³„ë¡œ (ë ˆì´ì—…ì€ í†µê³„ ì œì™¸ì´ì§€ë§Œ ê±°ë¦¬ëŠ” ì…ë ¥ ê°€ëŠ¥)
  proceedToDistanceInput();
});

// í¼í„° ë²„íŠ¼ í´ë¦­ - ìë™ìœ¼ë¡œ ìƒ· ì¶”ê°€
btnPutter.addEventListener('click', ()=>{
  const hole = roundData.holes[currentHole];
  
  // í¼í„° ìƒ· ìë™ ì¶”ê°€
  const shot = {
    club: 'Putter',
    result: shotResultSel.value || 'Green',
    distanceToHole: null, // ë‚˜ì¤‘ì— ê±°ë¦¬ ì…ë ¥ í›„ ì—…ë°ì´íŠ¸
    putts: 1,
    penalty: penaltyInput.value ? Number(penaltyInput.value) : 0,
    note: shotNoteInput.value.trim(),
    lie: puttLieEl.value || 'OnGreen',
    slope: puttSlopeEl.value || 'Flat',
    puttStartDistance: (puttDistanceEl.value !== '' && puttDistanceEl.value !== null && puttDistanceEl.value !== undefined) ? Number(puttDistanceEl.value) : null,
    timestamp: new Date().toISOString()
  };
  
  if(shot.club){
    hole.shots.push(shot);
    lastShotIndex = hole.shots.length - 1;
    putterCount++;
    putterCountEl.textContent = putterCount;
  }
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  clubWoodSel.value = '';
  clubIronWedgeSel.value = '';
  penaltyInput.value = '0';
  shotNoteInput.value = '';
  puttDistanceEl.value = '';
  
  // í™”ë©´ ì—…ë°ì´íŠ¸
  holeNumberEl.textContent = hole.shots.length;
  updateStatusBar();
  renderShots();
  saveData();
  
  // í™€ì¸ì´ ì•„ë‹ˆë©´ ê±°ë¦¬ ì…ë ¥ ë‹¨ê³„ë¡œ
  if(shotResultSel.value === 'InHole'){
    // í™€ì¸ì´ë©´ distanceToHoleë¥¼ 0ìœ¼ë¡œ ì„¤ì •í•˜ê³  í¼ ì´ˆê¸°í™”
    hole.shots[lastShotIndex].distanceToHole = 0;
    saveData();
    clearShotForm();
  } else {
    proceedToDistanceInput();
  }
});

// ê²°ê³¼ ì„ íƒ ì‹œ í™€ì¸ì´ë©´ í¼í„° ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
shotResultSel.addEventListener('change', ()=>{
  if(shotResultSel.value === 'InHole'){
    // í™€ì¸ ì„ íƒ ì‹œ í¼í„° ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
    putterCount = 0;
    putterCountEl.textContent = putterCount;
  }
});

// í™€ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateHoleDisplay(){
  const hole = roundData.holes[currentHole];
  // ëª¨ë“  ìƒ·(í¼í„° í¬í•¨)ì„ ìƒ· ê°œìˆ˜ë¡œ í‘œì‹œ
  holeNumberEl.textContent = hole.shots.length; // í° ìˆ«ì: ì „ì²´ ìƒ· ê°œìˆ˜
  holeNumLabelEl.textContent = hole.hole; // ì‘ì€ ê¸€ì”¨: í™€ ë²ˆí˜¸
  holeParInputEl.value = hole.par;
  holeYardInputEl.value = hole.yard;
  holeInputUnitEl.value = roundData.distanceUnit || 'yd'; // ì…ë ¥ ë‹¨ìœ„ ì´ˆê¸°í™”
  currentHoleNumEl.textContent = hole.hole;
  updateConvertedDistance(); // ë³€í™˜ê°’ ì—…ë°ì´íŠ¸
  
  // í¼í„° ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
  putterCount = 0;
  putterCountEl.textContent = putterCount;
  
  updateStatusBar();
  renderShots();
  clearShotForm();
  
  // ë²„íŠ¼ í™œì„±í™” ì œì–´
  btnPrevHole.disabled = currentHole === 0;
  btnNextHole.disabled = currentHole === 17;
}

// Parì™€ ì•¼ë“œ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
holeParInputEl.addEventListener('change', ()=>{
  roundData.holes[currentHole].par = Number(holeParInputEl.value);
  clearShotForm(); // Par ë³€ê²½ ì‹œ ë””í´íŠ¸ í´ëŸ½ ì¬ì„¤ì •
  saveData();
});

holeYardInputEl.addEventListener('change', ()=>{
  const inputValue = Number(holeYardInputEl.value) || 0;
  const inputUnit = holeInputUnitEl.value;
  const targetUnit = roundData.distanceUnit || 'yd';
  
  // ì…ë ¥ ë‹¨ìœ„ê°€ ë¼ìš´ë“œ ë‹¨ìœ„ì™€ ë‹¤ë¥´ë©´ ë³€í™˜í•´ì„œ ì €ì¥
  const savedValue = convertDistance(inputValue, inputUnit, targetUnit);
  roundData.holes[currentHole].yard = savedValue;
  saveData();
  updateConvertedDistance();
});

// í™€ ì „ì¥ ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì „ì²´ ì„ íƒ
holeYardInputEl.addEventListener('focus', function() {
  this.select();
});

// ìƒíƒœë°” ì—…ë°ì´íŠ¸
function updateStatusBar(){
  let totalShots = 0;
  let completed = 0;
  roundData.holes.forEach(h => {
    // ëª¨ë“  ìƒ·(í¼í„° í¬í•¨)ì„ ì´ ìƒ·ìˆ˜ì— í¬í•¨
    totalShots += h.shots.length;
    if(h.shots.length > 0) completed++;
  });
  totalShotsEl.textContent = totalShots;
  completedHolesEl.textContent = `${completed} / 18`;
}

// ìƒ· ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
function renderShots(){
  const hole = roundData.holes[currentHole];
  shotListEl.innerHTML = '';
  
  hole.shots.forEach((shot, idx) => {
    const div = document.createElement('div');
    div.className = 'shot-item';
    
    // í¸ì§‘ ì¤‘ì¸ ìƒ·ì´ë©´ ì„ íƒëœ í‘œì‹œ
    if(editingIndex === idx){
      div.classList.add('selected');
    }
    
    const info = document.createElement('div');
    info.className = 'shot-info';
    
    const club = shot.club || 'í´ëŸ½';
    const result = shot.result || '';
    const unit = roundData.distanceUnit || 'yd';
    const dist = shot.distanceToHole != null ? `${shot.distanceToHole}${unit}` : '';
    const puttsInfo = shot.putts > 0 ? ` (${shot.putts}í¼íŠ¸)` : '';
    
    // ë ˆì´ì—… ìƒ·ì¼ ê²½ìš° íŠ¹ë³„ í‘œì‹œ
    let additionalInfo = '';
    let secondLine = '';
    if(shot.club === 'LayUp' || shot.isLayup){
      // ë ˆì´ì—… ìƒ·: í†µê³„ ì œì™¸ í‘œì‹œ
      secondLine = `<div style="font-size:0.9em; color:#ffc107;">ë ˆì´ì—… (í†µê³„ ì œì™¸)</div>`;
    } else if(shot.club === 'Putter'){
      // í¼í„° ìƒ·: result í‘œì‹œ ì•ˆí•¨, í¼íŒ… ì •ë³´ë§Œ í‘œì‹œ
      const puttDetails = [];
      if(shot.lie) puttDetails.push(shot.lie);
      if(shot.slope) puttDetails.push(shot.slope);
      if(shot.puttStartDistance != null) puttDetails.push(`${shot.puttStartDistance}${unit}`);
      secondLine = puttDetails.length > 0 ? `<div style="font-size:0.9em; color:var(--muted);">${puttDetails.join(', ')}</div>` : '';
    } else {
      // ì¼ë°˜ ìƒ·: resultì™€ ê±°ë¦¬ í‘œì‹œ
      secondLine = `<div>${result} ${dist}</div>`;
    }
    
    info.innerHTML = `
      <div>#${idx + 1} ${club}${puttsInfo}</div>
      ${secondLine}
    `;
    
    // ìƒ· ì •ë³´ í´ë¦­ ì‹œ í¸ì§‘ ëª¨ë“œë¡œ ì§„ì…
    info.onclick = () => loadShotForEdit(idx);
    info.style.cursor = 'pointer';
    
    const delBtn = document.createElement('button');
    delBtn.className = 'shot-delete';
    delBtn.textContent = 'ì‚­ì œ';
    delBtn.onclick = () => deleteShot(idx);
    
    div.appendChild(info);
    div.appendChild(delBtn);
    shotListEl.appendChild(div);
  });
}

// ìƒ· í¸ì§‘ì„ ìœ„í•´ í¼ì— ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
function loadShotForEdit(idx){
  const hole = roundData.holes[currentHole];
  const shot = hole.shots[idx];
  
  // í¼í„° ìƒ·ì€ í¸ì§‘ ë¶ˆê°€ (ë³„ë„ ë²„íŠ¼ìœ¼ë¡œ ê´€ë¦¬)
  if(shot.club === 'Putter'){
    alert('í¼í„° ìƒ·ì€ í¼í„° ë²„íŠ¼ìœ¼ë¡œë§Œ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  // ë ˆì´ì—… ìƒ·ì€ í¸ì§‘ ë¶ˆê°€ (ë³„ë„ ë²„íŠ¼ìœ¼ë¡œ ê´€ë¦¬)
  if(shot.club === 'LayUp' || shot.isLayup){
    alert('ë ˆì´ì—… ìƒ·ì€ ë ˆì´ì—… ë²„íŠ¼ìœ¼ë¡œë§Œ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  // ëª¨ë“  ì„¹ì…˜ í‘œì‹œ
  distanceInputSection.classList.add('hidden');
  clubRecommendSection.classList.add('hidden');
  clubSelectSection.classList.remove('hidden');
  resultInputSection.classList.remove('hidden');
  
  // í¼ì— ë°ì´í„° ë¡œë“œ
  if(['Driver', '3Wood', '5Wood', 'Utility1', 'Utility2'].includes(shot.club)){
    clubWoodSel.value = shot.club;
    clubIronWedgeSel.value = '';
  } else {
    clubWoodSel.value = '';
    clubIronWedgeSel.value = shot.club;
  }
  
  shotResultSel.value = shot.result || 'Fairway';
  penaltyInput.value = shot.penalty || 0;
  shotNoteInput.value = shot.note || '';
  
  // í¸ì§‘ ëª¨ë“œ ì„¤ì •
  editingIndex = idx;
  lastShotIndex = idx; // í¸ì§‘ ì‹œì—ë„ lastShotIndex ì„¤ì •
  isSaveMode = true;
  btnAddShot.textContent = 'ìˆ˜ì • ì €ì¥';
  
  // ìƒ· ë¦¬ìŠ¤íŠ¸ ì¬ë Œë”ë§í•˜ì—¬ ì„ íƒ í‘œì‹œ
  renderShots();
}

// ê±°ë¦¬ í™•ì¸ ë²„íŠ¼ í´ë¦­
btnConfirmDistance.addEventListener('click', ()=>{
  const distance = Number(distanceInput.value);
  // 0ì´ ì•„ë‹ˆê³  ìœ íš¨í•œ ìˆ«ìì¸ì§€ë§Œ ì²´í¬ (ìŒìˆ˜ í—ˆìš©)
  if(distanceInput.value === '' || isNaN(distance)){
    alert('ê±°ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }
  
  // ë°©ê¸ˆ ì €ì¥í•œ ìƒ·ì˜ distanceToHole ì—…ë°ì´íŠ¸
  const hole = roundData.holes[currentHole];
  if(lastShotIndex >= 0 && lastShotIndex < hole.shots.length){
    hole.shots[lastShotIndex].distanceToHole = distance;
    saveData();
  }
  
  // ê±°ë¦¬ ì…ë ¥ ì„¹ì…˜ ìˆ¨ê¸°ê³  í´ëŸ½ ì¶”ì²œ ì„¹ì…˜ í‘œì‹œ
  distanceInputSection.classList.add('hidden');
  showClubRecommendation(distance);
});

// ì§ì ‘ ì„ íƒ ë²„íŠ¼ í´ë¦­
btnManualClubSelect.addEventListener('click', ()=>{
  // ì¶”ì²œ í´ëŸ½ ì„¹ì…˜ ìˆ¨ê¸°ê³  í´ëŸ½ ì„ íƒ ë° ê²°ê³¼ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
  clubRecommendSection.classList.add('hidden');
  clubSelectSection.classList.remove('hidden');
  resultInputSection.classList.remove('hidden');
});

// ìƒ· ì¶”ê°€ (ìš°ë“œ, ì•„ì´ì–¸/ì›¨ì§€ ì „ìš©)
btnAddShot.addEventListener('click', ()=>{
  const club = clubWoodSel.value || clubIronWedgeSel.value;
  
  if(!club){
    alert('í´ëŸ½ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    return;
  }
  
  const hole = roundData.holes[currentHole];
  
  // í¸ì§‘ ëª¨ë“œì¸ ê²½ìš° ê¸°ì¡´ distanceToHole ìœ ì§€
  const existingDistance = (editingIndex >= 0 && hole.shots[editingIndex]) 
    ? hole.shots[editingIndex].distanceToHole 
    : null;
  
  const shot = {
    club: club,
    result: shotResultSel.value || 'Fairway',
    distanceToHole: existingDistance, // í¸ì§‘ ì‹œ ê¸°ì¡´ ê°’, ìƒˆ ìƒ·ì€ null (ë‚˜ì¤‘ì— ì—…ë°ì´íŠ¸)
    putts: 0,
    penalty: penaltyInput.value ? Number(penaltyInput.value) : 0,
    note: shotNoteInput.value.trim(),
    lie: '',
    slope: '',
    puttStartDistance: null,
    timestamp: new Date().toISOString()
  };
  
  if(editingIndex >= 0){
    hole.shots[editingIndex] = shot;
    lastShotIndex = editingIndex;
    editingIndex = -1;
    
    // í¸ì§‘ ì™„ë£Œ í›„ í¼ ì´ˆê¸°í™”
    updateHoleDisplay();
    saveData();
    clearShotForm();
    return;
  } else {
    hole.shots.push(shot);
    lastShotIndex = hole.shots.length - 1;
  }
  
  if(shotResultSel.value === 'InHole'){
    putterCount = 0;
    putterCountEl.textContent = putterCount;
  }
  
  updateHoleDisplay();
  saveData();
  
  // í™€ì¸ì´ ì•„ë‹ˆë©´ ê±°ë¦¬ ì…ë ¥ ë‹¨ê³„ë¡œ
  if(shotResultSel.value === 'InHole'){
    // í™€ì¸ì´ë©´ distanceToHoleë¥¼ 0ìœ¼ë¡œ ì„¤ì •í•˜ê³  í¼ ì´ˆê¸°í™”
    hole.shots[lastShotIndex].distanceToHole = 0;
    saveData();
    clearShotForm();
  } else {
    // ê±°ë¦¬ ì…ë ¥ ë‹¨ê³„ë¡œ
    proceedToDistanceInput();
  }
});

// ìƒ· ì‚­ì œ
function deleteShot(idx){
  if(confirm('ì´ ìƒ·ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    roundData.holes[currentHole].shots.splice(idx, 1);
    updateHoleDisplay();
    saveData();
  }
}

// ê±°ë¦¬ ì…ë ¥ ë‹¨ê³„ë¡œ ì§„í–‰
function proceedToDistanceInput(){
  // ëª¨ë“  ì…ë ¥ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
  clubRecommendSection.classList.add('hidden');
  clubSelectSection.classList.add('hidden');
  resultInputSection.classList.add('hidden');
  
  // ê±°ë¦¬ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
  distanceInputSection.classList.remove('hidden');
  distanceInput.value = '';
  distanceInput.focus();
  
  // í¼ ì´ˆê¸°í™” (ê±°ë¦¬ ì œì™¸)
  clubWoodSel.value = '';
  clubIronWedgeSel.value = '';
  shotResultSel.value = 'Fairway';
  penaltyInput.value = '0';
  shotNoteInput.value = '';
}

// í´ëŸ½ ì¶”ì²œ í‘œì‹œ
function showClubRecommendation(distance){
  const unit = roundData.distanceUnit || 'yd';
  // ìŒìˆ˜ì¸ ê²½ìš°ë„ í‘œì‹œ
  const displayText = distance < 0 ? `${distance} ${unit} (í™€ ì§€ë‚˜ì¹¨)` : `${distance} ${unit}`;
  displayDistance.textContent = displayText;
  
  let clubButtons = [];
  
  // ì ˆëŒ€ê°’ìœ¼ë¡œ ê±°ë¦¬ ê¸°ë°˜ í´ëŸ½ ì¶”ì²œ
  const absDistance = Math.abs(distance);
  
  // ê±°ë¦¬ì— ë”°ë¥¸ í´ëŸ½ ì¶”ì²œ
  if(absDistance <= 10){
    clubButtons = [{label: 'í¼í„°', code: 'Putter'}];
  } else if(absDistance <= 50){
    clubButtons = [{label: 'SW', code: 'SW'}, {label: 'AW', code: 'AW'}, {label: 'Wedge3', code: 'Wedge3'}, {label: 'Wedge2', code: 'Wedge2'}];
  } else if(absDistance <= 70){
    clubButtons = [{label: 'AW', code: 'AW'}, {label: 'Wedge1', code: 'Wedge1'}, {label: 'Wedge2', code: 'Wedge2'}, {label: 'Wedge3', code: 'Wedge3'}];
  } else if(absDistance <= 90){
    clubButtons = [{label: 'Wedge1', code: 'Wedge1'}, {label: 'Wedge2', code: 'Wedge2'}, {label: 'PW', code: 'PW'}, {label: '9I', code: '9Iron'}];
  } else if(absDistance <= 110){
    clubButtons = [{label: 'PW', code: 'PW'}, {label: '9I', code: '9Iron'}, {label: 'Wedge1', code: 'Wedge1'}, {label: '8I', code: '8Iron'}];
  } else if(absDistance <= 130){
    clubButtons = [{label: '9I', code: '9Iron'}, {label: '8I', code: '8Iron'}, {label: 'PW', code: 'PW'}, {label: '7I', code: '7Iron'}];
  } else if(absDistance <= 150){
    clubButtons = [{label: '8I', code: '8Iron'}, {label: '7I', code: '7Iron'}, {label: '9I', code: '9Iron'}, {label: '6I', code: '6Iron'}];
  } else if(absDistance <= 170){
    clubButtons = [{label: '7I', code: '7Iron'}, {label: '6I', code: '6Iron'}, {label: '8I', code: '8Iron'}, {label: '5I', code: '5Iron'}];
  } else if(absDistance <= 190){
    clubButtons = [{label: '6I', code: '6Iron'}, {label: '5I', code: '5Iron'}, {label: '7I', code: '7Iron'}, {label: '4I', code: '4Iron'}];
  } else if(absDistance <= 210){
    clubButtons = [{label: '5I', code: '5Iron'}, {label: '4I', code: '4Iron'}, {label: '6I', code: '6Iron'}, {label: 'UT1', code: 'Utility1'}];
  } else if(absDistance <= 230){
    clubButtons = [{label: '4I', code: '4Iron'}, {label: 'UT1', code: 'Utility1'}, {label: '5I', code: '5Iron'}, {label: 'UT2', code: 'Utility2'}];
  } else if(absDistance <= 250){
    clubButtons = [{label: 'UT1', code: 'Utility1'}, {label: 'UT2', code: 'Utility2'}, {label: '5W', code: '5Wood'}, {label: '4I', code: '4Iron'}];
  } else {
    clubButtons = [{label: '5W', code: '5Wood'}, {label: '3W', code: '3Wood'}, {label: 'UT1', code: 'Utility1'}, {label: 'Driver', code: 'Driver'}];
  }
  
  // í´ëŸ½ ë²„íŠ¼ HTML ìƒì„±
  clubRecommendButtons.innerHTML = clubButtons.map(club => 
    `<button type="button" onclick="selectRecommendedClub('${club.code}')" style="padding:8px 14px; background:var(--accent); color:#04221a; border:none; border-radius:6px; cursor:pointer; font-size:14px; font-weight:700; transition:all 0.2s ease;">${club.label}</button>`
  ).join('');
  
  clubRecommendSection.classList.remove('hidden');
}

// ì¶”ì²œ í´ëŸ½ ì„ íƒ
function selectRecommendedClub(clubCode){
  // í¼í„°ì¸ ê²½ìš° í¼í„° ë²„íŠ¼ ê°•ì¡°
  if(clubCode === 'Putter'){
    clubRecommendSection.classList.add('hidden');
    clubSelectSection.classList.add('hidden');
    resultInputSection.classList.add('hidden');
    btnPutter.style.animation = 'pulse 0.5s ease-in-out 3';
    btnPutter.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }
  
  // ìš°ë“œ/ìœ í‹¸ë¦¬í‹° ê³„ì—´
  if(['Driver', '3Wood', '5Wood', 'Utility1', 'Utility2'].includes(clubCode)){
    clubWoodSel.value = clubCode;
    clubIronWedgeSel.value = '';
  } 
  // ì•„ì´ì–¸/ì›¨ì§€ ê³„ì—´
  else {
    clubWoodSel.value = '';
    clubIronWedgeSel.value = clubCode;
  }
  
  // í´ëŸ½ ì¶”ì²œ ì„¹ì…˜ ìˆ¨ê¸°ê³  í´ëŸ½ ì„ íƒê³¼ ê²°ê³¼ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
  clubRecommendSection.classList.add('hidden');
  clubSelectSection.classList.remove('hidden');
  resultInputSection.classList.remove('hidden');
}



// ìƒ· ì…ë ¥ í¼ ì´ˆê¸°í™”
function clearShotForm(){
  const hole = roundData.holes[currentHole];
  const isFirstShot = hole.shots.length === 0;
  
  // ëª¨ë“  ì„¹ì…˜ ì´ˆê¸°í™”
  distanceInputSection.classList.add('hidden');
  clubRecommendSection.classList.add('hidden');
  
  // ì²« ë²ˆì§¸ ìƒ·ì¼ ë•Œ
  if(isFirstShot){
    // í´ëŸ½ ì„ íƒê³¼ ê²°ê³¼ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
    clubSelectSection.classList.remove('hidden');
    resultInputSection.classList.remove('hidden');
    
    // Parì— ë”°ë¼ ë””í´íŠ¸ í´ëŸ½ ì„ íƒ
    if(hole.par === 3){
      clubWoodSel.value = '';
      clubIronWedgeSel.value = '7Iron';
    } else if(hole.par === 4 || hole.par === 5){
      clubWoodSel.value = 'Driver';
      clubIronWedgeSel.value = '';
    } else {
      clubWoodSel.value = '';
      clubIronWedgeSel.value = '';
    }
  } else {
    // ì²« ë²ˆì§¸ ìƒ·ì´ ì•„ë‹Œ ê²½ìš°: ê±°ë¦¬ ì…ë ¥ë¶€í„° ì‹œì‘
    clubSelectSection.classList.add('hidden');
    resultInputSection.classList.add('hidden');
    proceedToDistanceInput();
  }
  
  shotResultSel.value = 'Fairway';
  distanceInput.value = '';
  penaltyInput.value = '0';
  shotNoteInput.value = '';
  
  isSaveMode = true;
  editingIndex = -1;
  btnAddShot.textContent = 'ì €ì¥';
  
  renderShots();
}

// ìŠ¤ì½”ì–´ íƒ€ì… ê³„ì‚° í•¨ìˆ˜
function getScoreType(strokes, par) {
  const diff = strokes - par;
  if (diff <= -3) return 'albatross';
  if (diff === -2) return 'eagle';
  if (diff === -1) return 'birdie';
  if (diff === 0) return 'par';
  if (diff === 1) return 'bogey';
  if (diff === 2) return 'double';
  if (diff === 3) return 'triple';
  return 'over';
}

// ìŠ¤ì½”ì–´ ë©”ì‹œì§€ ìƒì„± í•¨ìˆ˜
function getScoreMessage(strokes, par) {
  const scoreType = getScoreType(strokes, par);
  const diff = strokes - par;
  
  const messages = {
    'albatross': `ğŸ¦… Amazing! Albatross!\nCompleted Par ${par} in ${strokes} strokes!`,
    'eagle': `ğŸ¦… Excellent! Eagle!\nCompleted Par ${par} in ${strokes} strokes!`,
    'birdie': `ğŸ‘ Great! Birdie!\nCompleted Par ${par} in ${strokes} strokes!`,
    'par': `âœ¨ Nice! Par!\nCompleted Par ${par} in ${strokes} strokes!`,
    'bogey': `ğŸ’ª Bogey. Keep it up on the next hole!\nFinished Par ${par} in ${strokes} strokes.`,
    'double': `ğŸ™‚ Double Bogey. That's okay!\nFinished Par ${par} in ${strokes} strokes.`,
    'triple': `ğŸ˜Š Triple Bogey. You'll do better next time!\nFinished Par ${par} in ${strokes} strokes.`,
    'over': `ğŸŒŸ ${Math.abs(diff)} Over. Keep going!\nFinished Par ${par} in ${strokes} strokes.`
  };
  
  return messages[scoreType] || `Completed Par ${par} in ${strokes} strokes.`;
}

// í™€ ì™„ë£Œ (ë‹¤ìŒ í™€ë¡œ)
btnCompleteHole.addEventListener('click', ()=>{
  // í˜„ì¬ í™€ì˜ ë§ˆì§€ë§‰ í¼íŒ…ì„ ìë™ìœ¼ë¡œ í™€ì¸ ì²˜ë¦¬
  const currentHoleData = roundData.holes[currentHole];
  if(currentHoleData && currentHoleData.shots && currentHoleData.shots.length > 0){
    // ë§ˆì§€ë§‰ í¼í„° ìƒ· ì°¾ê¸°
    for(let i = currentHoleData.shots.length - 1; i >= 0; i--){
      const shot = currentHoleData.shots[i];
      if(shot && shot.club === 'Putter'){
        // resultë¥¼ 'InHole'ë¡œ ì„¤ì • (ë¹„ì–´ìˆê±°ë‚˜ ì´ë¯¸ ê°’ì´ ìˆì–´ë„ ë®ì–´ì”€)
        shot.result = 'InHole';
        break;
      }
    }
    
    // ìŠ¤ì½”ì–´ ê³„ì‚° ë° ë©”ì‹œì§€ í‘œì‹œ
    const strokes = currentHoleData.shots.length;
    const par = currentHoleData.par;
    const scoreMessage = getScoreMessage(strokes, par);
    
    // ìŠ¤ì½”ì–´ ë©”ì‹œì§€ ì¦‰ì‹œ í‘œì‹œ
    alert(scoreMessage);
  }
  
  // ë³€ê²½ì‚¬í•­ ì €ì¥
  saveData();
  
  if(currentHole < 17){
    currentHole++;
    updateHoleDisplay();
  } else {
    alert('ğŸ‰ Congratulations! You completed all 18 holes!');
  }
});

// ì´ì „/ë‹¤ìŒ í™€
btnPrevHole.addEventListener('click', ()=>{
  if(currentHole > 0){
    currentHole--;
    updateHoleDisplay();
  }
});

btnNextHole.addEventListener('click', ()=>{
  // í˜„ì¬ í™€ì˜ ë§ˆì§€ë§‰ í¼íŒ…ì„ ìë™ìœ¼ë¡œ í™€ì¸ ì²˜ë¦¬
  const currentHoleData = roundData.holes[currentHole];
  if(currentHoleData && currentHoleData.shots && currentHoleData.shots.length > 0){
    // ë§ˆì§€ë§‰ í¼í„° ìƒ· ì°¾ê¸°
    for(let i = currentHoleData.shots.length - 1; i >= 0; i--){
      const shot = currentHoleData.shots[i];
      if(shot && shot.club === 'Putter'){
        // resultë¥¼ 'InHole'ë¡œ ì„¤ì • (ë¹„ì–´ìˆê±°ë‚˜ ì´ë¯¸ ê°’ì´ ìˆì–´ë„ ë®ì–´ì”€)
        shot.result = 'InHole';
        break;
      }
    }
    
    // ìŠ¤ì½”ì–´ ê³„ì‚° ë° ë©”ì‹œì§€ í‘œì‹œ
    const strokes = currentHoleData.shots.length;
    const par = currentHoleData.par;
    const scoreMessage = getScoreMessage(strokes, par);
    
    // ìŠ¤ì½”ì–´ ë©”ì‹œì§€ ì¦‰ì‹œ í‘œì‹œ
    alert(scoreMessage);
  }
  
  // ë³€ê²½ì‚¬í•­ ì €ì¥
  saveData();
  
  if(currentHole < 17){
    currentHole++;
    updateHoleDisplay();
  }
});

// ìˆ˜ì • ë²„íŠ¼ (í˜„ì¬ í™€ ìˆ˜ì •)
btnEditHole.addEventListener('click', ()=>{
  // ìƒ· ë¦¬ìŠ¤íŠ¸ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ìˆ˜ì •í•˜ê¸° ì‰½ê²Œ í•¨
  const shotListEl = document.getElementById('shotList');
  if(shotListEl){
    shotListEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
});

// CSV ë‚´ë³´ë‚´ê¸° (ì›ë³¸ ë¶„ì„ íŒŒì¼ê³¼ í˜¸í™˜ë˜ëŠ” í˜•ì‹)
btnExportCSV.addEventListener('click', ()=>{
  const lines = [];
  
  // í—¤ë”
  const unit = roundData.distanceUnit || 'yd';
  lines.push(['Player', roundData.player, '', 'Date', roundData.date, '', 'Course', roundData.course, '', 'Unit', unit].join(','));
  lines.push('');
  
  // ìƒ· ë°ì´í„° í—¤ë” (ì›ë³¸ íŒŒì¼ê³¼ ë™ì¼í•œ í˜•ì‹)
  const hdr = ['Hole','Par','HoleYard','ShotNumber','ShotType','Result','DistanceToHole','Putts','Penalty','Note','Lie','Slope','PuttStartDistance','Timestamp'];
  lines.push(hdr.join(','));
  
  // ê° í™€ì˜ ìƒ· ë°ì´í„° - ìœ íš¨í•œ ìƒ·ë§Œ í¬í•¨
  roundData.holes.forEach(hole => {
    if(!hole.shots || hole.shots.length === 0) return;
    
    // ìœ íš¨í•œ ìƒ·ë§Œ í•„í„°ë§ (club/shotTypeì´ ìˆëŠ” ê²ƒë§Œ)
    const validShots = hole.shots.filter(shot => shot && (shot.club || shot.shotType));
    
    validShots.forEach((shot, idx) => {
      // ê° í•„ë“œë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
      const shotType = shot.club || shot.shotType || '';
      const result = (shot.result || '').toString().replace(/"/g, '""');
      const distanceVal = (shot.distanceToHole !== null && shot.distanceToHole !== undefined) ? shot.distanceToHole : '';
      const puttsVal = (shot.club === 'Putter') ? (shot.putts || 1) : 0; // í¼í„° ìƒ·ì€ ìµœì†Œ 1, ì¼ë°˜ ìƒ·ì€ 0
      const penaltyVal = shot.penalty || 0;
      const noteVal = (shot.note || '').toString().replace(/"/g, '""');
      const lieVal = shot.lie || '';
      const slopeVal = shot.slope || '';
      const puttStartVal = (shot.puttStartDistance !== null && shot.puttStartDistance !== undefined) ? shot.puttStartDistance : '';
      const timestampVal = shot.timestamp || new Date().toISOString();
      
      const row = [
        hole.hole,
        hole.par,
        hole.yard || '',
        idx + 1,  // ì‹¤ì œ ìˆœì„œëŒ€ë¡œ ë²ˆí˜¸ ë¶€ì—¬
        shotType,
        `"${result}"`,
        distanceVal,
        puttsVal,
        penaltyVal,
        `"${noteVal}"`,
        lieVal,
        slopeVal,
        puttStartVal,
        timestampVal
      ];
      lines.push(row.join(','));
    });
  });
  
  // í™€ ìš”ì•½ ì„¹ì…˜
  lines.push('');
  const holeSummaryHdr = ['Hole','Par','Yard','TotalShots','TotalPutts','TotalPenalties'];
  lines.push(holeSummaryHdr.join(','));
  
  roundData.holes.forEach(hole => {
    if(!hole.shots) return;
    const validShots = hole.shots.filter(shot => shot && (shot.club || shot.shotType));
    const totalShots = validShots.length;
    const totalPutts = validShots.reduce((sum, s) => sum + (s.putts || 0), 0);
    const totalPenalties = validShots.reduce((sum, s) => sum + (s.penalty || 0), 0);
    
    // ìƒ·ì´ ìˆëŠ” í™€ë§Œ ìš”ì•½ì— í¬í•¨
    if(totalShots > 0){
      lines.push([hole.hole, hole.par, hole.yard || '', totalShots, totalPutts, totalPenalties].join(','));
    }
  });
  
  // ë°ì´í„° ê²€ì¦: ìµœì†Œí•œ í•˜ë‚˜ì˜ ìƒ·ì´ ìˆëŠ”ì§€ í™•ì¸
  const totalShotsCount = roundData.holes.reduce((count, hole) => {
    if(!hole.shots) return count;
    const validShots = hole.shots.filter(shot => shot && (shot.club || shot.shotType));
    return count + validShots.length;
  }, 0);
  
  if(totalShotsCount === 0){
    alert('ê¸°ë¡ëœ ìƒ·ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìƒ·ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // UTF-8 BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
  const csv = '\uFEFF' + lines.join('\r\n');
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const filename = `golf_quick_${roundData.date || new Date().toISOString().slice(0,10)}.csv`;
  
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  setTimeout(() => {
    URL.revokeObjectURL(url);
    a.remove();
  }, 100);
  
  // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€ì™€ í•¨ê»˜ í†µê³„ ì •ë³´ í‘œì‹œ
  const holesWithData = roundData.holes.filter(h => h.shots && h.shots.some(s => s && (s.club || s.shotType))).length;
  alert(`CSV íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ ${holesWithData}ê°œ í™€, ${totalShotsCount}ê°œ ìƒ· ê¸°ë¡`);
});

// ìƒˆ ë¼ìš´ë“œ
btnReset.addEventListener('click', ()=>{
  if(confirm('í˜„ì¬ ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ìƒˆ ë¼ìš´ë“œë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
});

// ë°ì´í„° ì €ì¥ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)
function saveData(){
  try{
    // recordSectionì´ ë³´ì´ë©´ ë¼ìš´ë“œê°€ ì‹œì‘ëœ ê²ƒìœ¼ë¡œ íŒë‹¨
    const isStarted = recordSection && !recordSection.classList.contains('hidden');
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      roundData: roundData,
      currentHole: currentHole,
      started: isStarted
    }));
  }catch(e){
    console.error('ì €ì¥ ì‹¤íŒ¨:', e);
  }
}

// ë°ì´í„° ë³µêµ¬
function restoreData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    
    const saved = JSON.parse(raw);
    if(saved.roundData){
      roundData = saved.roundData;
      currentHole = saved.currentHole || 0;
      
      playerNameInput.value = roundData.player || '';
      roundDateInput.value = roundData.date || new Date().toISOString().slice(0,10);
      courseNameInput.value = roundData.course || '';
      distanceUnitSel.value = roundData.distanceUnit || 'yd';
      
      if(saved.started){
        roundInfo.classList.add('hidden');
        recordSection.classList.remove('hidden');
        exportSection.classList.remove('hidden');
        updateDistanceUnitLabels(); // ë‹¨ìœ„ ë¼ë²¨ ë³µì›
        updateHoleDisplay();
      }
    }
  }catch(e){
    console.error('ë³µêµ¬ ì‹¤íŒ¨:', e);
  }
}

// í´ëŸ½ ì„ íƒ ì‹œ ë‹¤ë¥¸ ì„ íƒ í•´ì œ ë° ê²°ê³¼ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
clubWoodSel.addEventListener('change', ()=>{
  if(clubWoodSel.value){
    clubIronWedgeSel.value = '';
    // ì²« ìƒ·ì´ ì•„ë‹ˆê³ , í´ëŸ½ ì¶”ì²œì—ì„œ ì„ íƒí•œ ê²½ìš° ê²°ê³¼ ì…ë ¥ ìë™ í‘œì‹œ
    if(clubRecommendSection && !clubRecommendSection.classList.contains('hidden')){
      clubRecommendSection.classList.add('hidden');
      resultInputSection.classList.remove('hidden');
    }
  }
});
clubIronWedgeSel.addEventListener('change', ()=>{
  if(clubIronWedgeSel.value){
    clubWoodSel.value = '';
    // ì²« ìƒ·ì´ ì•„ë‹ˆê³ , í´ëŸ½ ì¶”ì²œì—ì„œ ì„ íƒí•œ ê²½ìš° ê²°ê³¼ ì…ë ¥ ìë™ í‘œì‹œ
    if(clubRecommendSection && !clubRecommendSection.classList.contains('hidden')){
      clubRecommendSection.classList.add('hidden');
      resultInputSection.classList.remove('hidden');
    }
  }
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ì „ ë°ì´í„° í™•ì¸
function checkAndRestorePreviousData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    console.log('ì €ì¥ëœ ë°ì´í„°:', raw); // ë””ë²„ê¹…ìš©
    if(raw){
      const saved = JSON.parse(raw);
      console.log('íŒŒì‹±ëœ ë°ì´í„°:', saved); // ë””ë²„ê¹…ìš©
      // ë¼ìš´ë“œê°€ ì‹œì‘ëœ ìƒíƒœì˜€ëŠ”ì§€ í™•ì¸
      if(saved.started && saved.roundData){
        const playerName = saved.roundData.player || 'ì´ë¦„ì—†ìŒ';
        const roundDate = saved.roundData.date || 'ë‚ ì§œì—†ìŒ';
        const courseName = saved.roundData.course || 'ì½”ìŠ¤ì—†ìŒ';
        
        const message = `ì €ì¥ëœ ë¼ìš´ë“œ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤.\n\ní”Œë ˆì´ì–´: ${playerName}\në‚ ì§œ: ${roundDate}\nì½”ìŠ¤: ${courseName}\n\nì´ì „ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`;
        
        if(confirm(message)){
          restoreData();
        } else {
          // ì‚¬ìš©ìê°€ ê±°ë¶€í•˜ë©´ ì €ì¥ëœ ë°ì´í„° ì‚­ì œ
          localStorage.removeItem(STORAGE_KEY);
        }
      }
    }
  }catch(e){
    console.error('ë°ì´í„° í™•ì¸ ì‹¤íŒ¨:', e);
  }
}

// DOMì´ ì¤€ë¹„ë˜ë©´ ì´ì „ ë°ì´í„° í™•ì¸
if(document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', checkAndRestorePreviousData);
} else {
  // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
  checkAndRestorePreviousData();
}

// ìë™ ì €ì¥ (5ì´ˆë§ˆë‹¤)
setInterval(saveData, 5000);
</script>
</body>
</html>
